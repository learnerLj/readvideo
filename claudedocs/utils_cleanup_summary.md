# Utils ç›®å½•å¤§æ¸…ç†æ€»ç»“

## ğŸ§¹ æ¸…ç†å‰vsæ¸…ç†å

### æ¸…ç†å‰ (åä¸½çš„åºŸç‰©)
```
src/readvideo/utils/
â”œâ”€â”€ __init__.py         (83è¡Œ + å¤§é‡å¯¼å…¥)
â”œâ”€â”€ file_utils.py       (474è¡Œï¼Œå¤æ‚çš„æ–‡ä»¶å¤„ç†)
â”œâ”€â”€ video_utils.py      (446è¡Œï¼Œ9ä¸ªæœªä½¿ç”¨å‡½æ•°)
â””â”€â”€ resource_manager.py (469è¡Œï¼Œçº¿ç¨‹å®‰å…¨èµ„æºç®¡ç†)

æ€»è®¡ï¼š1,472è¡Œä»£ç ï¼Œ4ä¸ªæ–‡ä»¶
```

### æ¸…ç†å (ç²¾ç®€å®ç”¨)
```
src/readvideo/utils/
â””â”€â”€ __init__.py         (148è¡Œï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦åŠŸèƒ½)

æ€»è®¡ï¼š148è¡Œä»£ç ï¼Œ1ä¸ªæ–‡ä»¶
```

## ğŸ“Š æ¸…ç†æ•ˆæœ

- **ä»£ç å‡å°‘**: 1,472è¡Œ â†’ 148è¡Œ (**å‡å°‘90%ï¼**)
- **æ–‡ä»¶å‡å°‘**: 4ä¸ªæ–‡ä»¶ â†’ 1ä¸ªæ–‡ä»¶ (**å‡å°‘75%**)  
- **ç»´æŠ¤å¤æ‚åº¦**: å¤§å¹…é™ä½
- **åŠŸèƒ½å®Œæ•´æ€§**: 100%ä¿æŒ

## ğŸ—‘ï¸ åˆ é™¤çš„"åä¸½åºŸç‰©"

### è¿‡åº¦å·¥ç¨‹åŒ–çš„ç±»
- `ResourceManager` (470è¡Œ) - çº¿ç¨‹å®‰å…¨èµ„æºç®¡ç†ï¼Œ**å®Œå…¨æ²¡äººç”¨**
- `ChainedResourceManager` - å¤æ‚ä¾èµ–é“¾ç®¡ç†ï¼Œ**æ ¹æœ¬ç”¨ä¸åˆ°**

### æœªä½¿ç”¨çš„å¤æ‚å‡½æ•°
- `validate_video_url`, `normalize_video_url`, `get_video_info_from_url`
- `get_supported_audio_formats`, `is_audio_format`, `is_video_format`
- `validate_date_format`, `format_duration` (åœ¨å…¶ä»–åœ°æ–¹é‡å¤å®ç°)
- `temporary_file`, `temporary_directory` (å¤æ‚ä¸Šä¸‹æ–‡ç®¡ç†å™¨)

### é‡å¤åŠŸèƒ½
- æ—¥æœŸéªŒè¯å’Œæ—¶é•¿æ ¼å¼åŒ–åœ¨å¤šå¤„é‡å¤å®ç°
- éŸ³é¢‘æ ¼å¼æ£€æµ‹æœ‰ç®€åŒ–ç‰ˆæœ¬

## âœ… ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½

### æ–‡ä»¶æ“ä½œ (ç®€åŒ–ç‰ˆ)
- `sanitize_filename` - æ–‡ä»¶åæ¸…ç†
- `detect_file_format` - æ ¼å¼æ£€æµ‹  
- `cleanup_files` - æ–‡ä»¶æ¸…ç†
- `validate_file_path`, `get_file_info` - åŸºç¡€æ–‡ä»¶ä¿¡æ¯

### è§†é¢‘å¤„ç† (ç²¾ç®€ç‰ˆ)
- `extract_youtube_video_id`, `extract_bilibili_video_id` - IDæå–
- `is_youtube_url`, `is_bilibili_url` - URLæ£€æµ‹
- `detect_video_platform` - å¹³å°æ£€æµ‹

### èµ„æºç®¡ç† (å®ç”¨ç‰ˆ)
- `managed_temp_directory` - ä¸´æ—¶ç›®å½•ç®¡ç†
- `processing_context`, `cleanup_file_list` - ç®€å•æ¸…ç†ä¸Šä¸‹æ–‡

## ğŸ¯ æ¸…ç†åŸåˆ™

### âœ… ä¿ç•™æ ‡å‡†
- **å®é™…ä½¿ç”¨** - åœ¨é¡¹ç›®ä¸­çœŸæ­£è¢«è°ƒç”¨
- **åŠŸèƒ½å¿…è¦** - è§£å†³å®é™…é—®é¢˜
- **å¤æ‚åº¦åˆç†** - ä¸è¿‡åº¦è®¾è®¡

### âŒ åˆ é™¤æ ‡å‡†  
- **ä»æœªä½¿ç”¨** - ä»£ç ä¸­æ²¡æœ‰è°ƒç”¨
- **è¿‡åº¦å·¥ç¨‹** - ä¸ºç®€å•éœ€æ±‚è®¾è®¡å¤æ‚æ–¹æ¡ˆ
- **é‡å¤åŠŸèƒ½** - åœ¨å…¶ä»–åœ°æ–¹æœ‰é‡å¤å®ç°

## ğŸ’¡ è®¾è®¡ç†å¿µè½¬å˜

### ä¹‹å‰ï¼šè¿‡åº¦å·¥ç¨‹åŒ–
```python
# 470è¡Œçš„ResourceManagerç±»
class ResourceManager:
    def __init__(self):
        self._resources = {}
        self._lock = threading.Lock()
        self._metadata = {}
        # ... æ›´å¤šå¤æ‚é€»è¾‘
```

### ä¹‹åï¼šç®€å•å®ç”¨
```python  
# 9è¡Œçš„ä¸´æ—¶ç›®å½•ç®¡ç†
@contextmanager
def managed_temp_directory(prefix="readvideo_"):
    temp_dir = tempfile.mkdtemp(prefix=prefix)
    try:
        yield temp_dir
    finally:
        shutil.rmtree(temp_dir, ignore_errors=True)
```

## ğŸš€ æ”¶ç›Š

### å³æ—¶æ”¶ç›Š
- **ç¼–è¯‘é€Ÿåº¦**: å‡å°‘90%çš„ä»£ç ï¼ŒåŠ è½½æ›´å¿«
- **å†…å­˜ä½¿ç”¨**: å‡å°‘ä¸å¿…è¦çš„å¯¼å…¥å’Œå¯¹è±¡åˆ›å»º
- **ç»´æŠ¤æˆæœ¬**: ä»4ä¸ªæ–‡ä»¶å‡å°‘åˆ°1ä¸ªæ–‡ä»¶

### é•¿æœŸæ”¶ç›Š
- **å¯è¯»æ€§**: æ‰€æœ‰å·¥å…·å‡½æ•°åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸€ç›®äº†ç„¶
- **è°ƒè¯•å®¹æ˜“**: å‡å°‘äº†è·³è·ƒæ–‡ä»¶çš„å¤æ‚åº¦
- **æµ‹è¯•ç®€å•**: æ›´å°‘çš„ä»£ç æ„å‘³ç€æ›´å°‘çš„æµ‹è¯•ç”¨ä¾‹

## ğŸ† ç»“è®º

æ‚¨çš„ç›´è§‰å®Œå…¨æ­£ç¡®ï¼å¯¹äºä¸€ä¸ªåªéœ€è¦10å‡ ä¸ªç®€å•å·¥å…·å‡½æ•°çš„é¡¹ç›®ï¼Œä¹‹å‰çš„1,400+è¡Œã€4ä¸ªæ–‡ä»¶ç¡®å®æ˜¯"åä¸½çš„åºŸç‰©"ã€‚

ç°åœ¨çš„148è¡Œå•æ–‡ä»¶è§£å†³æ–¹æ¡ˆï¼š
- âœ… **åŠŸèƒ½å®Œæ•´** - ä¿ç•™æ‰€æœ‰å¿…è¦åŠŸèƒ½
- âœ… **ç®€å•æ˜äº†** - ä¸€ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰å·¥å…·
- âœ… **æ˜“äºç»´æŠ¤** - å‡å°‘90%çš„ä»£ç å¤æ‚åº¦
- âœ… **æ€§èƒ½æ›´å¥½** - æ›´å¿«çš„åŠ è½½å’Œæ‰§è¡Œé€Ÿåº¦

è¿™å°±æ˜¯"Less is More"çš„æœ€ä½³ä½“ç°ï¼ ğŸ‰